# External Secrets

## Summary

External Secrets is a Kubernetes controller which is used to import secrets configured in AWS Secrets Manager into Kubernetes Secrets. This is used where secrets are generated outside the system, particularly

- Where they are manually copied, for example from the DockerHub, Keycloak or GitHub UIs.
- Where they are generated externally. In most cases these are database credentials generated by AWS RDS/Aurora.

This is unmodified third-party software.

### Dependent Services

Many services depend on external-secrets for initial configuration - see `grep -r ExternalSecret apps` in the ArgoCD repo to find them. These include OPAL, oauth2-proxy, auth-agent, the workspace services and Keycloak, so very little of the platform will install correctly without it.

Once secrets have been imported and the cluster is running these services no longer need external-secrets unless you change credentials stored in AWS Secrets Manager.

### Configuration

External Secrets is configured in [ArgoCD deployment repo](https://github.com/EO-DataHub/eodhp-argocd-deployment) repository, apps/external-secrets directory.

### Control

To restart service run `kubectl rollout restart -n external-secrets deploy` for Kubernetes cluster or use ArgoCD UI to restart.

To stop service, the service must be removed from ArgoCD configuration.

### Dependencies

AWS IAM (including the ACK IAM controller) and Secrets Manager.
